$(function(t){const e=t("body");var i=[];function a(){let e=t('[name="form-bids-options-select-description"]');e.length&&!e.hasClass("select2-hidden-accessible")&&e.select2({multiple:!1,templateResult:function(t){return t.id,t.text}})}function o(){let e=t("[data-picker-bids-options]"),i=t("[data-picker2-bids-options]");e.length&&(e.datepicker({lang:lang.id,dateFormat:"dd.mm.yy"}),e.mask("99.99.9999")),i.length&&(i.datepicker({lang:lang.id,dateFormat:"mm.yy"}),i.mask("99.9999"))}function d(e,i=null){let a=e.attr("data-id"),o="error-validate";t('[data-error-validate="'+a+'"]').remove(),null===i?(t(".continue:last").prop("disabled",!1),e.removeClass(o)):(e.hasClass("hasDatepicker")?(t(".continue:last").removeClass("disabled"),t(".continue:last").removeClass("active"),e.removeClass(o)):(t(".continue:last").prop("disabled",!0),e.toggleClass(o,!0)),t('<div class="error" data-error-validate="'+a+'"><em></em><p>'+i+"</p></div>").appendTo("body").position({my:"left bottom",at:"left top-4",of:e}))}!function(){if("undefined"!=typeof dataSessionParams&&dataSessionParams.length)try{t.each(t.parseJSON(dataSessionParams),function(e,i){t('.bids-input[data-id="'+e+'"]').val(i.value)})}catch(t){console.log(t)}}(),o(),a(),e.on("click",'.bids-element.button:not(".finish")',function(e){e.preventDefault(),e.stopPropagation();let n=parseInt(t(this).attr("data-id")),s=parseInt(t(this).attr("data-tag-status")),l=parseInt(t(this).attr("data-root")),r=!1,c=null,u=null,p=!1,h=1;if(i=[],t(this).hasClass("disabled"))return!1;if(void 0!==t(this).attr("data-index")&&(u=t(this).attr("data-index")),void 0!==t(this).attr("data-value")&&(c=t(this).attr("data-value")),t("[data-error-validate]").remove(),!isNaN(l)&&!t(this).hasClass("continue")){if(t(this).hasClass("active"))return!1;if(r=!0,c=t(this).attr("data-value"),t(this).parent(".bids-section").find(".button").toggleClass("active",!1),t(this).parent(".bids-section").hasClass("bids-parent-actions")?t('.bids-params-section[data-id="'+n+'"] .bids-element').toggleClass("hide",!0).toggleClass("active",!1):0===l&&t(this).parent(".bids-section").nextAll(".bids-section").find(".bids-element").toggleClass("hide",!0).toggleClass("active",!1),l>0)return t(this).toggleClass("active",!0),t('.bids-element[data-parent="'+l+'"]').parent(".bids-section").nextAll(".bids-section").find(".bids-element").toggleClass("hide",!0).toggleClass("active",!1),t('.bids-element[data-parent="'+l+'"]').removeClass("hide"),t('.bids-element[data-parent="'+l+'"]').toggleClass("disabled",!1),t('.bids-params-section[data-id="'+n+'"]').nextAll(".bids-section").hide(),!1;let e=t('.bids-params-section[data-id="'+n+'"]');if(e.hasClass("use")||e.prev(".bids-parent-actions").hasClass("use"))return t('.bids-params-section[data-id="'+n+'"]').nextAll(".bids-section").show(),t(this).toggleClass("active",!0),!1;if(void 0===t(this).attr("data-index")&&(e.toggleClass("use",!0),e.prev(".bids-parent-actions").toggleClass("use",!0),!e.length)){let e=t(this).parent(".bids-parent-actions");if(e.hasClass("use"))return t(this).toggleClass("active",!0),!1;e.toggleClass("use",!0),r=!1}}let v=!1;if(!isNaN(n)&&t(this).hasClass("continue")&&!t(this).hasClass("disabled")){let e=t(this).closest(".bids-section").prev(".bids-section").find('.bids-input[data-id="'+n+'"]');void 0!==e&&(p=!0,e.val()?(c=e.val(),u=e.attr("data-index")):(e.attr("placeholder","необходимо заполнить"),v=!0))}if(!v&&t(this).hasClass("button")){if(t(this).hasClass("disabled")&&(v=!0),v)return!1;t(this).toggleClass("active",!0),r||t(this).parent(".bids-section").find(".button").toggleClass("disabled",!0)}if(v)return!1;let b=t("#form-save-session").html();if(c){let e=t('select[data-id-input="'+n+'"]');u?e.length&&!isNaN(parseInt(e.val()))?i.push({id:n,value:c,data_index:u,itemId:e.val()}):i.push({id:n,value:c,data_index:u}):e.length&&!isNaN(parseInt(e.val()))?i.push({id:n,value:c,itemId:e.val()}):i.push({id:n,value:c})}let f=t(".bids-section:last-child .bids-element").attr("data-id");if(void 0!==paramsBidsIdsUse[n]?h=0:paramsBidsIdsUse[n]=n,!isNaN(n)){let e={do:"go",id:n,value:c,html:b,params:i,isInput:p,saveHtml:h,tag:s};t.post({url:["/req/bidsoptions.php"],type:"post",data:e,success:function(e){!isNaN(parseInt(f))&&1!==parseInt(f)&&t(e.html).find('.bids-element[data-id="'+f+'"]').length&&t('[data-id="'+f+'"]').parent(".bids-section").remove(),void 0!==e.code&&400===parseInt(e.code)?void 0!==e.errors&&null!==e.errors&&void 0!==e.errors.data_index&&void 0!==e.errors.text_error&&d(t('[data-index="'+e.errors.data_index+'"]'),e.errors.text_error):(void 0!==e.html&&null!==e.html&&e.html&&t("#form-save-session").append(e.html),void 0!==e.code&&null!==e.code&&parseInt(e.code)),function(e){if(void 0!==e.actions&&null!==e.actions)try{t.each(e.actions,function(e,i){if(void 0!==i.actions&&null!==i.actions)!function e(i){try{t.each(i,function(t,i){void 0!==i.validators&&(paramsBidsOptionsValidators[i.id]=i),void 0!==i.childs&&null!==i.childs&&e(i.childs)})}catch(t){console.log(t)}}(i.actions);else if(void 0!==i.validators)try{paramsBidsOptionsValidators[i.id]=i}catch(t){alert(t)}})}catch(t){console.log(t)}}(e),void 0!==e.errormsg&&alert(e.errormsg),a()},error:function(t,e){console.log(t),console.log(e)},complete:function(){o()}})}}),e.on("change",'[name="form-bids-options-select-description"]',function(e){let i=t(this).find("option:selected").text(),a=parseInt(t(this).attr("data-id-input"));if(!isNaN(a)){isNaN(parseInt(t(this).val()))&&(i=null);try{let o=t('.bids-input[data-id="'+a+'"]');(!o.val()||o.val()&&!o.hasClass("used"))&&o.text(i)}catch(e){}}}),e.on("input",".bids-element.bids-input",function(e){t(this).val()?t(this).toggleClass("used",!0):t(this).toggleClass("used",!1)}),e.on("input",".bids-input[data-index]",function(e){let i=t(this);d(i),t("button.finish").length||i.parent(".bids-section").nextAll(".bids-section").find(".bids-element").removeClass("active").removeClass("disabled");let a=i.attr("type");void 0!==a&&!1!==a&&"number"===a&&(this.value/this.value!=1||this.value<0)&&d(i,lang.bidsErrorCreateValueNumbers)}),e.on("click",".bids-element.finish",function(e){if(e.preventDefault(),t(".error-upload-bid").remove(),t("[data-checkbox-finish]").length){let i=!0;if(t.each(t("[data-checkbox-finish]"),(e,a)=>{if(!t(a).is(":checked"))return i=!1,function(e,i,a){t('<div class="error error-upload-bid '+a+'"><em></em><p>'+i+"</p></div>").appendTo("body").position({my:"left bottom",at:"left top-4",of:e})}(t(a).next("label"),lang.textErrorBidsOptionsErrorFinishCheckbox,t(a).attr("id")),!1}),!1===i)return e.stopPropagation(),!1}!function(e=!1){e&&(i=[]);t.each(t(".bids-input"),function(a,o){let d=parseInt(t(o).attr("data-id")),n=t(o).val(),s=t(o).attr("data-index");if(!isNaN(d)){let a=!1;e||(t.each(i,(t,e)=>{void 0!==e.data_index&&d==e.id&&s==e.data_index&&(a=!0),void 0===e.data_index&&d==e.id&&n==e.value&&(a=!0)}),!1===a&&(void 0!==s?i.push({id:d,value:n,data_index:s}):i.push({id:d,value:n}))),void 0!==s?i.push({id:d,value:n,data_index:s}):i.push({id:d,value:n})}}),t.each(t('.bids-element.button.active[data-root="0"]'),function(e,a){let o=parseInt(t(a).attr("data-id")),d=t(a).attr("data-value"),n=t(a).attr("data-index");if(!isNaN(o)&&void 0!==d){let e=!1;t.each(i,(t,i)=>{void 0!==i.data_index&&o==i.id&&n==i.data_index&&(e=!0),void 0===i.data_index&&o==i.id&&d==i.value&&(e=!0)}),!1===e&&(void 0!==n?i.push({id:o,value:d,data_index:n}):i.push({id:o,value:d}))}})}(!0);let a={do:"save",params:i};t.post({url:["/req/bidsoptions.php"],type:"post",data:a,success:function(e){if(void 0!==e.code){if(0===parseInt(e.code)){let t=lang.id;t&&void 0!==t||(t="ru"),location.href="/"+t+"/partner"}1===parseInt(e.code)&&void 0!==e.errors&&null!==e.errors&&void 0!==e.errors.data_index&&void 0!==e.errors.text_error&&d(t('[data-index="'+e.errors.data_index+'"]'),e.errors.text_error)}},error:function(t,e){console.log(t),console.log(e)},complete:function(){}})}),e.on("change","[data-checkbox-finish]",function(e){t(".error-upload-bid."+t(this).attr("id")).remove()}),e.on("submit","#edit-description-partner",function(e){if(e.preventDefault(),!window.bidsNew.accessSave(t(this)))return!1;let i=t(this),a=i.find(".bid").val(),o=i.find(".description").val();t.post("/req/bids.php",{do:"edit-description",bid_id:a,description:o},function(e){1===e.code&&(i.find(".description").before('<div class="error" style="margin-top: -20px;"><em></em>'+e.errormsg+"</div>"),setTimeout(function(){t(".error").remove()},2e3))})}),e.on("submit","#edit-format-partner",function(e){if(e.preventDefault(),!window.bidsNew.accessSave(t(this)))return!1;let i=t(this),a=i.find(".bid").val(),o=i.find(".format").val();t.post("/req/bids.php",{do:"edit-format",bid_id:a,format:o},function(e){1===e.code&&(i.find(".format").before('<div class="error" style="margin-top: -20px;"><em></em>'+e.errormsg+"</div>"),setTimeout(function(){t(".error").remove()},2e3))})}),e.on("submit","#edit-cost-partner",function(e){if(e.preventDefault(),!window.bidsNew.accessSave(t(this)))return!1;let i=t(this),a=i.find(".bid").val(),o=i.find(".cost").val();t.post("/req/bids.php",{do:"edit-cost",bid_id:a,cost:o},function(e){1===e.code&&(i.find(".cost").before('<div class="error" style="margin-top: -20px;"><em></em>'+e.errormsg+"</div>"),setTimeout(function(){t(".error").remove()},2e3))})}),e.on("submit","#edit-country-partner",function(e){if(e.preventDefault(),!window.bidsNew.accessSave(t(this)))return!1;let i=t(this),a=i.find(".bid").val(),o=i.find(".country").val();t.post("/req/bids.php",{do:"edit-country",bid_id:a,country:o},function(e){1===e.code&&(i.find(".country").before('<div class="error" style="margin-top: -20px;"><em></em>'+e.errormsg+"</div>"),setTimeout(function(){t(".error").remove()},2e3))})}),t(".bid-id-partner").click(function(){var e=t("<input>"),i=t(this).siblings(".more-info-show").children("span").text();t("body").append(e),e.val(i).select(),document.execCommand("copy"),e.remove()}),window.bidsNew={toggleSection:function(e=null){let i=t(e?".more-info-bids-"+e:".more-info-bids"),a=t(e?".chevrons-"+e:".chevrons");i.find("section").is(":visible")?(i.slideToggle(50),i.find("section").hide(),a.removeClass("fa-chevron-up").addClass("fa-chevron-down")):(i.slideToggle(150),i.find("section").slideToggle(50),a.removeClass("fa-chevron-down").addClass("fa-chevron-up"))},accessSave:function(e){let i=t(e).find('input[type="submit"]');i.toggleClass("save-field-btn");let a=i.closest("tr"),o=i.attr("data-id"),d=a.find(".field-edit-"+o),n=a.find(".field-view-"+o);return i.hasClass("save-field-btn")?(n.hide(),d.show(),!1):(d.hide(),n.show(),d.val().length&&n.text(d.val()),!0)},accs_payments_dialog:function(e,i){t("#upload_dialog").remove();var a=t('<div id="upload_dialog" title="'+lang.requested_payouts+'" style="display:none; position: initial;"><table class="bids list zebra"><thead><tr><th>'+lang.bidListPaid+"</th><th>"+lang.bidListWaitPaid+"</th></tr></thead><tbody><tr><td>"+e+"</td><td>"+i+"</td></tr></tbody></table></div>").appendTo("body").dialog({autoOpen:!0,open:function(){t(".ui-widget-overlay").click(function(){a.remove()})},modal:!0,width:t("body").width()>800?800:"95%",maxHeight:"90%"})},accs_unlink_after_download:function(e){setTimeout(function(){t.post("/req/bids.php",{do:"delete_file_after_download",file_name:e},function(e){t(".ui-dialog-content").remove(),1===e.code&&console.log("success!")})},1e3)},accs_count_dialog:function(e,i,a){t("#upload_dialog").remove(),t.post("/req/bids.php",{do:"accs_count_dialog",bid_id:e,type:i,upload:a},function(a){if(void 0!==a.linkDownload){let e='<a href="'+a.linkDownload+'" target="_blank" download onclick="bidsNew.accs_unlink_after_download('+a.fileName+');">'+lang.downloadFileBid+"</a>";var o=t('<div id="upload_dialog" title="'+lang.bidsLinkDownloadAccs+'">'+e+"</div>").appendTo("body").dialog({autoOpen:!0,open:function(){t(".ui-widget-overlay").click(function(){o.remove()})},modal:!0,width:t("body").width()>800?800:"95%",maxHeight:"90%"})}else{if("double"==i)var d="<th>"+lang.account+"</th><th>"+lang.count+"</th>";else d="<th>"+lang.account+"</th>";let s=lang.upload;switch(i){case"upload":s=lang.uploaded;break;case"selled":s=lang.selled;break;case"not-paid":s=lang.not_paid;break;case"on_sale":s=lang.on_sale}o=t('<div id="upload_dialog" title="'+s+'" style="display:none; position: initial;"><input type="text" placeholder="'+lang.searchTitle+'"><table class="bids list zebra"><thead><tr><th>#</th>'+d+"</tr></thead><tbody>"+a.dataBids+"</tbody></table></div>").appendTo("body").dialog({autoOpen:!0,open:function(){t(".ui-widget-overlay").click(function(){o.remove()})},modal:!0,width:t("body").width()>800?800:"95%",maxHeight:"90%"});n(),document.querySelector("#upload_dialog input").addEventListener("keyup",async()=>{let a=document.querySelector("#upload_dialog input").value;t.post("/req/bids.php",{do:"accs_search_dialog",bid_id:e,text:a,action_dialog:"on_sale",type:i},function(t){document.querySelector("#upload_dialog table tbody").remove(),document.querySelector("#upload_dialog table").innerHTML='<table class="bids list zebra"><thead><tr><th>#</th><th>'+lang.account+"</th></tr></thead><tbody>"+t.dataBids+"</tbody>",n()})})}})},accs_invalid_dialog:function(e,i){t("#invalid_dialog").remove(),t.post("/req/bids.php",{do:"accs_invalid_dialog",bid_id:e,upload:i},function(i){if(void 0!==i.linkDownload){let e='<a href="'+i.linkDownload+'" target="_blank" download onclick="bidsNew.accs_unlink_after_download('+i.fileName+');">'+lang.downloadFileBid+"</a>";var a=t('<div id="invalid_dialog" title="Link download">'+e+"</div>").appendTo("body").dialog({autoOpen:!0,open:function(){t(".ui-widget-overlay").click(function(){a.remove()})},modal:!0,width:t("body").width()>800?800:"95%",maxHeight:"90%"})}else{a=t('<div id="invalid_dialog" title="'+lang.invalid+'" style="display:none"><input type="text" placeholder="'+lang.searchTitle+'"><table class="bids list zebra"><thead><tr><th>#</th><th>'+lang.orderNumber+"</th><th>"+lang.account+"</th><th>"+lang.ticketUrl+"</th></tr></thead><tbody>"+i.dataBids+"</tbody></table></div>").appendTo("body").dialog({autoOpen:!0,open:function(){t(".ui-widget-overlay").click(function(){a.remove()})},modal:!0,width:t("body").width()>800?800:"95%",maxHeight:"90%"});n(),document.querySelector("#invalid_dialog input").addEventListener("keyup",async()=>{let i=document.querySelector("#invalid_dialog input").value;t.post("/req/bids.php",{do:"accs_search_dialog",bid_id:e,text:i,action_dialog:"invalid"},function(t){document.querySelector("#invalid_dialog table tbody").remove(),document.querySelector("#invalid_dialog table").innerHTML='<table class="bids list zebra"><thead><tr><th>#</th><th>'+lang.orderNumber+"</th><th>"+lang.account+"</th><th>"+lang.ticketUrl+"</th></tr></thead><tbody>"+t.dataBids+"</tbody>",n()})})}})},changeProxy:function(e,i){t.post("/req/bids.php",{do:"change-proxy-tag",bid_id:e,proxy:i},function(t){1===t.code&&alert(t.errormsg)})},remove_unsold:function(e){var i=lang.removeUnsoldAccounts;if(!confirm(i))return!1;t.post("/req/bids.php",{do:"remove_unsold",bid_id:e},function(t){0==t.code?location.reload():alert(t.errormsg)})}};const n=async()=>{let t=document.querySelectorAll(".bid-copy-login");for(let e=0;e<t.length;e++)t[e].addEventListener("click",async()=>{try{let t=e+1,i=document.querySelector(".item-acc"+t).textContent;navigator.clipboard&&await navigator.clipboard.writeText(i)}catch(t){console.error(`Failed to copy: ${t}`)}})}});